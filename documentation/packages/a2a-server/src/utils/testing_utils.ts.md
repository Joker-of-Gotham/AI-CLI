# testing_utils.ts

## 概述

`testing_utils.ts` 是 a2a-server 包中的测试工具文件。该文件提供了一系列用于简化测试编写的辅助函数和模拟配置，主要用于创建模拟对象和验证测试结果。

## 导出的函数

### createMockConfig
创建一个模拟的配置对象，用于测试需要配置参数的组件：
- 接受可选的覆盖配置对象作为参数
- 返回包含各种模拟方法的配置对象
- 默认模拟工具注册表、审批模式、IDE 模式等配置
- 提供默认的存储、目标目录和模型配置

### createStreamMessageRequest
创建一个用于测试的流消息请求对象：
- 接受文本内容、消息 ID 和可选的任务 ID 作为参数
- 返回符合 JSON-RPC 2.0 标准的消息请求对象
- 包含消息内容、元数据和 coderAgent 配置

### assertUniqueFinalEventIsLast
验证事件数组中的最终事件：
- 检查最后一个事件是否为最终的输入请求状态事件
- 验证事件数组中只有一个最终事件且位于最后位置
- 确认最终事件的元数据和状态正确

### assertTaskCreationAndWorkingStatus
验证任务创建和工作状态事件：
- 检查第一个事件是否为任务创建事件
- 验证第二个事件是否为工作状态更新事件
- 确认事件的类型和状态值正确

## 使用的技术

- **Vitest**: 使用 `vi.fn()` 创建模拟函数
- **TypeScript**: 使用类型注解确保类型安全
- **Partial Types**: 使用 Partial<Config> 允许部分配置覆盖

## 依赖模块

- `@a2a-js/sdk`: 提供任务和事件相关类型
- `@google/gemini-cli-core`: 提供配置、存储和客户端相关类型
- `vitest`: 提供测试框架功能

## 设计考虑

该工具文件的设计旨在：
1. 减少测试代码中的重复配置
2. 提供一致的测试数据创建方式
3. 简化复杂对象的模拟过程
4. 提供通用的断言函数验证测试结果