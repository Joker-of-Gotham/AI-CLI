<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AI-CLI: RFC: Gemini CLI A2A Development-Tool Extension</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">AI-CLI
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md_packages_2a2a-server_2development-extension-rfc.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">RFC: Gemini CLI A2A Development-Tool Extension </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md1"></a>
1. Introduction</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2"></a>
1.1 Overview</h2>
<p>To standardize client integrations with the Gemini CLI agent, this document proposes the <span class="tt">development-tool</span> extension for the A2A protocol.</p>
<p>Rather than creating a new protocol, this specification builds upon the existing A2A protocol. As an open-source standard recently adopted by the Linux Foundation, A2A provides a robust foundation for core concepts like tasks, messages, and streaming events. This extension-based approach allows us to leverage A2A's proven architecture while defining the specific capabilities required for rich, interactive workflows with the Gemini CLI agent.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md3"></a>
1.2 Motivation</h2>
<p>Recent work integrating Gemini CLI with clients like Zed and Gemini Code Assist’s agent mode has highlighted the need for a robust, standard communication protocol. Standardizing on A2A provides several key advantages:</p>
<ul>
<li><b>Solid Foundation</b>: Provides a robust, open standard that ensures a stable, predictable, and consistent integration experience across different IDEs and client surfaces.</li>
<li><b>Extensibility</b>: Creates a flexible foundation to support new tools and workflows as they emerge.</li>
<li><b>Ecosystem Alignment</b>: Aligns Gemini CLI with a growing industry standard, fostering broader interoperability.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md4"></a>
2. Communication Flow</h1>
<p>The interaction follows A2A’s task-based, streaming pattern. The client sends a <span class="tt">message/stream</span> request and the agent responds with a <span class="tt">contextId</span> / <span class="tt">taskId</span> and a stream of events. <span class="tt">TaskStatusUpdateEvent</span> events are used to convey the overall state of the task. The task is complete when the agent sends a final <span class="tt">TaskStatusUpdateEvent</span> with <span class="tt">final: true</span> and a terminal status like <span class="tt">completed</span> or <span class="tt">failed</span>.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md5"></a>
2.1 Asynchronous Responses and Notifications</h2>
<p>Clients that may disconnect from the agent should supply a <span class="tt">PushNotificationConfig</span> to the agent with the initial <span class="tt">message/stream</span> method or subsequently with the <span class="tt">tasks/pushNotificationConfig/set</span> method so that the agent can call back when updates are ready.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md6"></a>
3. The <span class="tt">development-tool</span> extension</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md7"></a>
3.1 Overview</h2>
<p>The <span class="tt">development-tool</span> extension establishes a communication contract for workflows between a client and the Gemini CLI agent. It consists of a specialized set of schemas, embedded within core A2A data structures, that enable the agent to stream real-time updates on its state and thought process. These schemas also provide the mechanism for the agent to request user permission before executing tools.</p>
<p><b>Sample Agent Card</b></p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;name&quot;: &quot;Gemini CLI Agent&quot;,</div>
<div class="line">  &quot;description&quot;: &quot;An agent that generates code based on natural language instructions.&quot;,</div>
<div class="line">  &quot;capabilities&quot;: {</div>
<div class="line">    &quot;streaming&quot;: true,</div>
<div class="line">    &quot;extensions&quot;: [</div>
<div class="line">      {</div>
<div class="line">        &quot;uri&quot;: &quot;https://github.com/google-gemini/gemini-cli/blob/main/docs/a2a/developer-profile/v0/spec.md&quot;,</div>
<div class="line">        &quot;description&quot;: &quot;An extension for interactive development tasks, enabling features like code generation, tool usage, and real-time status updates.&quot;,</div>
<div class="line">        &quot;required&quot;: true</div>
<div class="line">      }</div>
<div class="line">    ]</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Versioning</b></p>
<p>The agent card <span class="tt">uri</span> field contains an embedded semantic version. The client must extract this version to determine compatibility with the agent extension using the compatibility logic defined in Semantic Versioning 2.0.0 spec.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8"></a>
3.2 Schema Definitions</h2>
<p>This section defines the schemas for the <span class="tt">development-tool</span> A2A extension, organized by their function within the communication flow. Note that all custom objects included in the <span class="tt">metadata</span> field (e.g. <span class="tt">Message.metadata</span>) must be keyed by the unique URI that points to that extension’s spec to prevent naming collisions with other extensions.</p>
<p><b>Initialization &amp; Configuration</b></p>
<p>The first message in a session must contain an <span class="tt">AgentSettings</span> object in its metadata. This object provides the agent with the necessary configuration information for proper initialization. Additional configuration settings (ex. MCP servers, allowed tools, etc.) can be added to this message.</p>
<p><b>Schema</b></p>
<div class="fragment"><div class="line">syntax = &quot;proto3&quot;;</div>
<div class="line"> </div>
<div class="line">// Configuration settings for the Gemini CLI agent.</div>
<div class="line">message AgentSettings {</div>
<div class="line">  // The absolute path to the workspace directory where the agent will execute.</div>
<div class="line">  string workspace_path = 1;</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Agent-to-Client Messages</b></p>
<p>All real-time updates from the agent (including its thoughts, tool calls, and simple text replies) are streamed to the client as <span class="tt">TaskStatusUpdateEvents</span>.</p>
<p>Each Event contains a <span class="tt">Message</span> object, which holds the content in one of two formats:</p>
<ul>
<li><b>TextPart</b>: Used for standard text messages. This part requires no custom schema.</li>
<li><b>DataPart</b>: Used for complex, structured objects. Tool Calls and Thoughts are sent this way, each using their respective schemas defined below.</li>
</ul>
<p><b>Tool Calls</b></p>
<p>The <span class="tt">ToolCall</span> schema is designed to provide a structured representation of a tool’s execution lifecycle. This protocol defines a clear state machine and provides detailed schemas for common development tasks (file edits, shell commands, MCP Tool), ensuring clients can build reliable UIs without being tied to a specific agent implementation.</p>
<p>The core principle is that the agent sends a <span class="tt">ToolCall</span> object on every update. This makes client-side logic stateless and simple.</p>
<p><b>Tool Call Lifecycle</b></p>
<ol type="1">
<li><b>Creation</b>: The agent sends a <span class="tt">ToolCall</span> object with <span class="tt">status: PENDING</span>. If user permission is required, the <span class="tt">confirmation_request</span> field will be populated.</li>
<li><b>Confirmation</b>: If the client needs to confirm the message, the client will send a <span class="tt">ToolCallConfirmation</span>. If the client responds with a cancellation, execution will be skipped.</li>
<li><b>Execution</b>: Once approved (or if no approval is required), the agent sends an update with <span class="tt">status: EXECUTING</span>. It can stream real-time progress by updating the <span class="tt">live_content</span> field.</li>
<li><b>Completion</b>: The agent sends a final update with the status set to <span class="tt">SUCCEEDED</span>, <span class="tt">FAILED</span>, or <span class="tt">CANCELLED</span> and populates the appropriate result field.</li>
</ol>
<p><b>Schema</b></p>
<div class="fragment"><div class="line">syntax = &quot;proto3&quot;;</div>
<div class="line"> </div>
<div class="line">import &quot;google/protobuf/struct.proto&quot;;</div>
<div class="line"> </div>
<div class="line">// ToolCall is the central message represeting a tool&#39;s execution lifecycle.</div>
<div class="line">// The entire object is sent from the agent to client on every update.</div>
<div class="line">message ToolCall {</div>
<div class="line">  // A unique identifier, assigned by the agent</div>
<div class="line">  string tool_call_id = 1;</div>
<div class="line"> </div>
<div class="line">  // The current state of the tool call in its lifecycle</div>
<div class="line">  ToolCallStatus status = 2;</div>
<div class="line"> </div>
<div class="line">  // Name of the tool being called (e.g. &#39;Edit&#39;, &#39;ShellTool&#39;)</div>
<div class="line">  string tool_name = 3;</div>
<div class="line"> </div>
<div class="line">  // An optional description of the tool call&#39;s purpose to show the user</div>
<div class="line">  optional string description = 4;</div>
<div class="line"> </div>
<div class="line">  // The structured input params provided by the LLM for tool invocation.</div>
<div class="line">  google.protobuf.Struct input_parameters = 5;</div>
<div class="line"> </div>
<div class="line">  // String containing the real-time output from the tool as it executes (primarily designed for shell output).</div>
<div class="line">  // During streaming the entire string is replaced on each update</div>
<div class="line">  optional string live_content = 6;</div>
<div class="line"> </div>
<div class="line">  // The final result of the tool (used to replace live_content when applicable)</div>
<div class="line">  oneof result {</div>
<div class="line">    // The output on tool success</div>
<div class="line">    ToolOutput output = 7;</div>
<div class="line">    // The error details if the tool failed</div>
<div class="line">    ErrorDetails error = 8;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  // If the tool requires user confirmation, this field will be populated while status is PENDING</div>
<div class="line">  optional ConfirmationRequest confirmation_request = 9;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Possible execution status of a ToolCall</div>
<div class="line">enum ToolCallStatus {</div>
<div class="line">  STATUS_UNSPECIFIED = 0;</div>
<div class="line">  PENDING = 1;</div>
<div class="line">  EXECUTING = 2;</div>
<div class="line">  SUCCEEDED = 3;</div>
<div class="line">  FAILED = 4;</div>
<div class="line">  CANCELLED = 5;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// ToolOuput represents the final, successful, output of a tool</div>
<div class="line">message ToolOutput {</div>
<div class="line">  oneof result {</div>
<div class="line">    string text = 1;</div>
<div class="line">    // For ToolCalls which resulted in a file modification</div>
<div class="line">    FileDiff diff = 2;</div>
<div class="line">    // A generic fallback for any other structured JSON data</div>
<div class="line">    google.protobuf.Struct structured_data = 3;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// A structured representation of an error</div>
<div class="line">message ErrorDetails {</div>
<div class="line">  // User facing error message</div>
<div class="line">  string message = 1;</div>
<div class="line">  // Optional agent-specific error type or category (e.g. read_content_failure, grep_execution_error, mcp_tool_error)</div>
<div class="line">  optional string type = 2;</div>
<div class="line">  // Optional status code</div>
<div class="line">  optional int32 status_code = 3;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// ConfirmationRequest is sent from the agent to client to request user permission for a ToolCall</div>
<div class="line">message ConfirmationRequest {</div>
<div class="line">  // A list of choices for the user to select from</div>
<div class="line">  repeated ConfirmationOption options = 1;</div>
<div class="line">  // Specific details of the action requiring user confirmation</div>
<div class="line">  oneof details {</div>
<div class="line">    ExecuteDetails execute_details = 2;</div>
<div class="line">    FileDiff file_edit_details = 3;</div>
<div class="line">    McpDetails mcp_details = 4;</div>
<div class="line">    GenericDetails generic_details = 5;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// A single choice presented to the user during a confirmation request</div>
<div class="line">message ConfirmationOption {</div>
<div class="line">  // Unique ID for the choice (e.g. proceed_once, cancel)</div>
<div class="line">  string id = 1;</div>
<div class="line">  // Human-readable choice (e.g. Allow Once, Reject).</div>
<div class="line">  string name = 2;</div>
<div class="line">  // An optional longer description for a tooltip</div>
<div class="line">  optional string description = 3;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Details for a request to execute a shell command</div>
<div class="line">message ExecuteDetails {</div>
<div class="line">  // The shell command to be executed</div>
<div class="line">  string command = 1;</div>
<div class="line">  // An optional directory in which the command will be run</div>
<div class="line">  optional string working_directory = 2;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">message FileDiff {</div>
<div class="line">  string file_name = 1;</div>
<div class="line">  // The absolute path to the file to modify</div>
<div class="line">  string file_path = 2;</div>
<div class="line">  // The original content, if the file exists</div>
<div class="line">  optional string old_content = 3;</div>
<div class="line">  string new_content = 4;</div>
<div class="line">  // Pre-formatted diff string for display</div>
<div class="line">  optional string formatted_diff = 5;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Details for an MCP (Model Context Protocol) tool confirmation</div>
<div class="line">message McpDetails {</div>
<div class="line">  // The name of the MCP server that provides the tool</div>
<div class="line">  string server_name = 1;</div>
<div class="line">  // THe name of the tool being called from the MCP Server</div>
<div class="line">  string tool_name = 2;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Generic catch-all for ToolCall requests that don&#39;t fit other types</div>
<div class="line">message GenericDetails {</div>
<div class="line">  // Description of the action requiring confirmation</div>
<div class="line">  string description = 1;</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Agent Thoughts</b></p>
<p><b>Schema</b></p>
<div class="fragment"><div class="line">syntax = &quot;proto3&quot;;</div>
<div class="line"> </div>
<div class="line">// Represents a thought with a subject and a detailed description.</div>
<div class="line">message AgentThought {</div>
<div class="line">  // A concise subject line or title for the thought.</div>
<div class="line">  string subject = 1;</div>
<div class="line"> </div>
<div class="line">  // The description or elaboration of the thought itself.</div>
<div class="line">  string description = 2;</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Event Metadata</b></p>
<p>The <span class="tt">metadata</span> object in <span class="tt">TaskStatusUpdateEvent</span> is used by the A2A client to deserialize the <span class="tt">TaskStatusUpdateEvents</span> into their appropriate objects.</p>
<p><b>Schema</b></p>
<div class="fragment"><div class="line">syntax = &quot;proto3&quot;;</div>
<div class="line"> </div>
<div class="line">// A DevelopmentToolEvent event.</div>
<div class="line">message DevelopmentToolEvent {</div>
<div class="line">  // Enum representing the specific type of development tool event.</div>
<div class="line">  enum DevelopmentToolEventKind {</div>
<div class="line">    // The default, unspecified value.</div>
<div class="line">    DEVELOPMENT_TOOL_EVENT_KIND_UNSPECIFIED = 0;</div>
<div class="line">    TOOL_CALL_CONFIRMATION = 1;</div>
<div class="line">    TOOL_CALL_UPDATE = 2;</div>
<div class="line">    TEXT_CONTENT = 3;</div>
<div class="line">    STATE_CHANGE = 4;</div>
<div class="line">    THOUGHT = 5;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  // The specific kind of event that occurred.</div>
<div class="line">  DevelopmentToolEventKind kind = 1;</div>
<div class="line"> </div>
<div class="line">  // The model used for this event.</div>
<div class="line">  string model = 2;</div>
<div class="line"> </div>
<div class="line">  // The tier of the user (optional).</div>
<div class="line">  string user_tier = 3;</div>
<div class="line"> </div>
<div class="line">  // An unexpected error occured in the agent execution (optional).</div>
<div class="line">  string error = 4;</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Client-to-Agent Messages</b></p>
<p>When the agent sends a <span class="tt">TaskStatusUpdateEvent</span> with <span class="tt">status.state</span> set to <span class="tt">input-required</span> and its message contains a <span class="tt">ConfirmationRequest</span>, the client must respond by sending a new <span class="tt">message/stream</span> request.</p>
<p>This new request must include the <span class="tt">contextId</span> and the <span class="tt">taskId</span> from the ongoing task and contain a <span class="tt">ToolCallConfirmation</span> object. This object conveys the user's decision regarding the tool call that was awaiting approval.</p>
<p><b>Schema</b></p>
<div class="fragment"><div class="line">syntax = &quot;proto3&quot;;</div>
<div class="line"> </div>
<div class="line">// The client&#39;s response to a ConfirmationRequest.</div>
<div class="line">message ToolCallConfirmation {</div>
<div class="line">  // A unique identifier, assigned by the agent</div>
<div class="line">  string tool_call_id = 1;</div>
<div class="line">  // The &#39;id&#39; of the ConfirmationOption chosen by the user.</div>
<div class="line">  string selected_option_id = 2;</div>
<div class="line">  // Included if the user modifies the proposed change.</div>
<div class="line">  // The type should correspond to the original ConfirmationRequest details.</div>
<div class="line">  oneof modified_details {</div>
<div class="line">    // Corresponds to a FileDiff confirmation</div>
<div class="line">    ModifiedFileDetails file_details = 3;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">message ModifiedFileDetails {</div>
<div class="line">  // The new content after user edits.</div>
<div class="line">  string new_content = 1;</div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md9"></a>
3.3 Method Definitions</h2>
<p>This section defines the new methods introduced by the <span class="tt">development-tool</span> extension.</p>
<p><b>Method: <span class="tt">commands/get</span></b></p>
<p>This method allows the client to discover slash commands supported by Gemini CLI. The client should call this method during startup to dynamically populate its command list.</p>
<div class="fragment"><div class="line">// Response message containing the list of all top-level slash commands.</div>
<div class="line">message GetAllSlashCommandsResponse {</div>
<div class="line">  // A list of the top-level slash commands.</div>
<div class="line">  repeated SlashCommand commands = 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Represents a single slash command, which can contain subcommands.</div>
<div class="line">message SlashCommand {</div>
<div class="line">  // The primary name of the command.</div>
<div class="line">  string name = 1;</div>
<div class="line">  // A detailed description of what the command does.</div>
<div class="line">  string description = 2;</div>
<div class="line">  // A list of arguments that the command accepts.</div>
<div class="line">  repeated SlashCommandArgument arguments = 3;</div>
<div class="line">  // A list of nested subcommands.</div>
<div class="line">  repeated SlashCommand sub_commands = 4;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Defines the structure for a single slash command argument.</div>
<div class="line">message SlashCommandArgument {</div>
<div class="line">  // The name of the argument.</div>
<div class="line">  string name = 1;</div>
<div class="line">  // A brief description of what the argument is for.</div>
<div class="line">  string description = 2;</div>
<div class="line">  // Whether the argument is required or optional.</div>
<div class="line">  bool is_required = 3;</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Method: <span class="tt">command/execute</span></b></p>
<p>This method allows the client to execute a slash command. Following the initial <span class="tt">ExecuteSlashCommandResponse</span>, the agent will use the standard streaming mechanism to communicate the command's progress and output. All subsequent updates, including textual output, agent thoughts, and any required user confirmations for tool calls (like executing a shell command), will be sent as <span class="tt">TaskStatusUpdateEvent</span> messages, re-using the schemas defined above.</p>
<div class="fragment"><div class="line">// Request to execute a specific slash command.</div>
<div class="line">message ExecuteSlashCommandRequest {</div>
<div class="line">  // The path to the command, e.g., [&quot;memory&quot;, &quot;add&quot;] for /memory add</div>
<div class="line">  repeated string command_path = 1;</div>
<div class="line">  // The arguments for the command as a single string.</div>
<div class="line">  string args = 2;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// Enum for the initial status of a command execution request.</div>
<div class="line">enum CommandExecutionStatus {</div>
<div class="line">  // Default unspecified status.</div>
<div class="line">  COMMAND_EXECUTION_STATUS_UNSPECIFIED = 0;</div>
<div class="line">  // The command was successfully received and its execution has started.</div>
<div class="line">  STARTED = 1;</div>
<div class="line">  // The command failed to start (e.g., command not found, invalid format).</div>
<div class="line">  FAILED_TO_START = 2;</div>
<div class="line">  // The command has been paused and is waiting for the user to confirm</div>
<div class="line">  // a set of shell commands.</div>
<div class="line">  AWAITING_SHELL_CONFIRMATION = 3;</div>
<div class="line">  // The command has been paused and is waiting for the user to confirm</div>
<div class="line">  // a specific action.</div>
<div class="line">  AWAITING_ACTION_CONFIRMATION = 4;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// The immediate, async response after requesting a command execution.</div>
<div class="line">message ExecuteSlashCommandResponse {</div>
<div class="line">  // A unique taskID for this specific command execution.</div>
<div class="line">  string execution_id = 1;</div>
<div class="line">  // The initial status of the command execution.</div>
<div class="line">  CommandExecutionStatus status = 2;</div>
<div class="line">  // An optional message, particularly useful for explaining why a command</div>
<div class="line">  // failed to start.</div>
<div class="line">  string message = 3;</div>
<div class="line">}</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md10"></a>
4. Separation of Concerns</h1>
<p>We believe that all client-side context (ex., workspace state) and client-side tool execution (ex. read active buffers) should be routed through MCP.</p>
<p>This approach enforces a strict separation of concerns: the A2A <span class="tt">development-tool</span> extension standardizes communication to the agent, while MCP serves as the single, authoritative interface for client-side capabilities.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md11"></a>
Appendix</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md12"></a>
A. Example Interaction Flow</h2>
<ol type="1">
<li><b>Client -&gt; Server</b>: The client sends a <span class="tt">message/stream</span> request containing the initial prompt and configuration in an <span class="tt">AgentSettings</span> object.</li>
<li><b>Server -&gt; Client</b>: SSE stream begins.<ul>
<li><b>Event 1</b>: The server sends a <span class="tt">Task</span> object with &lsquo;status.state: 'submitted&rsquo;<span class="tt"> and the new </span>taskId<span class="tt">.</span></li>
<li><span class="tt">**Event 2**: The server sends a </span>TaskStatusUpdateEvent<span class="tt"> with the metadata </span>kind<span class="tt"> set to </span>'STATE_CHANGE'<span class="tt"> and </span>status.state<span class="tt"> set to </span>'working'<span class="tt">.</span></li>
</ul>
</li>
<li><span class="tt"> **Agent Logic**: The agent processes the prompt and decides to call the </span>write_file<span class="tt"> tool, which requires user confirmation.</span></li>
<li><span class="tt"> **Server -&gt; Client**:<ul>
<li>**Event 3**: The server sends a </li>
</ul>
</span>TaskStatusUpdateEvent<span class="tt">. The metadata </span>kind<span class="tt"> is </span>'TOOL_CALL_UPDATE'<span class="tt">, and the </span>DataPart<span class="tt"> contains a </span>ToolCall<span class="tt"> object with its </span>status<span class="tt"> as </span>'PENDING'<span class="tt"> and a populated </span>confirmation_request<span class="tt">.<ul>
<li>**Event 4**: The server sends a final </li>
</ul>
</span>TaskStatusUpdateEvent<span class="tt"> for this exchange. The metadata </span>kind<span class="tt"> is </span>'STATE_CHANGE'<span class="tt">, the </span>status.state<span class="tt"> is </span>'input-required'<span class="tt">, and </span>final<span class="tt"> is </span>true<span class="tt">. The stream for this request ends.</span></li>
<li><span class="tt"> **Client**: The client UI renders the confirmation prompt based on the </span>ToolCall<span class="tt"> object from Event 3. The user clicks "Approve."</span></li>
<li><span class="tt"> **Client -&gt; Server**: The client sends a new </span>message/stream<span class="tt"> request. It includes the </span>taskId<span class="tt"> from the ongoing task and a </span>DataPart<span class="tt"> containing a </span>ToolCallConfirmation<span class="tt"> object (e.g., </span>{"tool_call_id": "...", "selected_option_id": "proceed_once"}<span class="tt">).</span></li>
<li><span class="tt"> **Server -&gt; Client**: A new SSE stream begins for the second request.<ul>
<li>**Event 1**: The server sends a </li>
</ul>
</span>TaskStatusUpdateEvent<span class="tt"> with </span>kind: 'TOOL_CALL_UPDATE'<span class="tt">, containing the </span>ToolCall<span class="tt"> object with its </span>status<span class="tt"> now set to </span>'EXECUTING'<span class="tt">.<ul>
<li>**Event 2**: After the tool runs, the server sends another </li>
</ul>
</span>TaskStatusUpdateEvent<span class="tt"> with </span>kind: 'TOOL_CALL_UPDATE'<span class="tt">, containing the </span>ToolCall<span class="tt"> with its </span>status<span class="tt"> as </span>'SUCCEEDED'<span class="tt">.</span></li>
<li><span class="tt"> **Agent Logic**: The agent receives the successful tool result and generates a final textual response.</span></li>
<li><span class="tt"> **Server -&gt; Client**:<ul>
<li>**Event 3**: The server sends a </li>
</ul>
</span>TaskStatusUpdateEvent<span class="tt"> with </span>kind: 'TEXT_CONTENT'<span class="tt"> and a </span>TextPart<span class="tt"> containing the agent's final answer.<ul>
<li>**Event 4**: The server sends the final </li>
</ul>
</span>TaskStatusUpdateEvent<span class="tt">. The </span>kind<span class="tt"> is </span>'STATE_CHANGE'<span class="tt">, the </span>status.state<span class="tt"> is </span>'completed'<span class="tt">, and </span>final<span class="tt"> is </span>true<span class="tt">. The stream ends.</span></li>
<li><span class="tt">**Client**: The client displays the final answer. The task is now complete but can be continued by sending another message with the same </span>taskId`. </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
