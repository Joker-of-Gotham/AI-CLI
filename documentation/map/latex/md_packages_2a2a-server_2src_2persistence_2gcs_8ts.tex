\chapter{src/persistence/gcs.\+ts }
\hypertarget{md_packages_2a2a-server_2src_2persistence_2gcs_8ts}{}\label{md_packages_2a2a-server_2src_2persistence_2gcs_8ts}\index{src/persistence/gcs.ts@{src/persistence/gcs.ts}}
\label{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md123}%
\Hypertarget{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md123}%


这个文件实现了基于 Google Cloud Storage (GCS) 的任务存储功能。\hypertarget{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md124}{}\doxysection{\texorpdfstring{主要类}{主要类}}\label{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md124}
\hypertarget{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md125}{}\doxysubsection{\texorpdfstring{GCSTask\+Store 类}{GCSTask\+Store 类}}\label{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md125}
实现基于 GCS 的任务存储。\hypertarget{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md126}{}\doxysubsubsection{\texorpdfstring{构造函数}{构造函数}}\label{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md126}

\begin{DoxyCode}{0}
\DoxyCodeLine{constructor(bucketName:\ string)}

\end{DoxyCode}


参数：
\begin{DoxyItemize}
\item {\ttfamily bucket\+Name}\+: GCS 存储桶名称
\end{DoxyItemize}\hypertarget{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md127}{}\doxysubsubsection{\texorpdfstring{方法}{方法}}\label{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md127}
\hypertarget{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md128}{}\doxysubsubsubsection{\texorpdfstring{{\ttfamily initialize\+Bucket}}{{\ttfamily initialize\+Bucket}}}\label{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md128}

\begin{DoxyCode}{0}
\DoxyCodeLine{private\ async\ initializeBucket():\ Promise<void>}

\end{DoxyCode}


初始化存储桶。\hypertarget{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md129}{}\doxysubsubsubsection{\texorpdfstring{{\ttfamily ensure\+Bucket\+Initialized}}{{\ttfamily ensure\+Bucket\+Initialized}}}\label{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md129}

\begin{DoxyCode}{0}
\DoxyCodeLine{private\ async\ ensureBucketInitialized():\ Promise<void>}

\end{DoxyCode}


确保存储桶已初始化。\hypertarget{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md130}{}\doxysubsubsubsection{\texorpdfstring{{\ttfamily get\+Object\+Path}}{{\ttfamily get\+Object\+Path}}}\label{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md130}

\begin{DoxyCode}{0}
\DoxyCodeLine{private\ getObjectPath(taskId:\ string,\ type:\ ObjectType):\ string}

\end{DoxyCode}


获取对象路径。

参数：
\begin{DoxyItemize}
\item {\ttfamily task\+Id}\+: 任务 ID
\item {\ttfamily type}\+: 对象类型
\end{DoxyItemize}

返回：
\begin{DoxyItemize}
\item string\+: 对象路径
\end{DoxyItemize}\hypertarget{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md131}{}\doxysubsubsubsection{\texorpdfstring{{\ttfamily save}}{{\ttfamily save}}}\label{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md131}

\begin{DoxyCode}{0}
\DoxyCodeLine{async\ save(task:\ SDKTask):\ Promise<void>}

\end{DoxyCode}


保存任务。

参数：
\begin{DoxyItemize}
\item {\ttfamily task}\+: SDK 任务对象
\end{DoxyItemize}\hypertarget{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md132}{}\doxysubsubsubsection{\texorpdfstring{{\ttfamily load}}{{\ttfamily load}}}\label{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md132}

\begin{DoxyCode}{0}
\DoxyCodeLine{async\ load(taskId:\ string):\ Promise<SDKTask\ |\ undefined>}

\end{DoxyCode}


加载任务。

参数：
\begin{DoxyItemize}
\item {\ttfamily task\+Id}\+: 任务 ID
\end{DoxyItemize}

返回：
\begin{DoxyItemize}
\item Promise\texorpdfstring{$<$}{<}SDKTask \texorpdfstring{$\vert$}{|} undefined\texorpdfstring{$>$}{>}\+: SDK 任务对象或 undefined
\end{DoxyItemize}\hypertarget{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md133}{}\doxysubsection{\texorpdfstring{No\+Op\+Task\+Store 类}{No\+Op\+Task\+Store 类}}\label{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md133}
实现无操作的任务存储，仅委托实际存储操作给真实存储。\hypertarget{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md134}{}\doxysubsubsection{\texorpdfstring{构造函数}{构造函数}}\label{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md134}

\begin{DoxyCode}{0}
\DoxyCodeLine{constructor(private\ realStore:\ TaskStore)}

\end{DoxyCode}


参数：
\begin{DoxyItemize}
\item {\ttfamily real\+Store}\+: 真实的任务存储实例
\end{DoxyItemize}\hypertarget{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md135}{}\doxysubsubsection{\texorpdfstring{方法}{方法}}\label{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md135}
\hypertarget{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md136}{}\doxysubsubsubsection{\texorpdfstring{{\ttfamily save}}{{\ttfamily save}}}\label{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md136}

\begin{DoxyCode}{0}
\DoxyCodeLine{async\ save(task:\ SDKTask):\ Promise<void>}

\end{DoxyCode}


保存任务（无操作）。

参数：
\begin{DoxyItemize}
\item {\ttfamily task}\+: SDK 任务对象
\end{DoxyItemize}\hypertarget{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md137}{}\doxysubsubsubsection{\texorpdfstring{{\ttfamily load}}{{\ttfamily load}}}\label{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md137}

\begin{DoxyCode}{0}
\DoxyCodeLine{async\ load(taskId:\ string):\ Promise<SDKTask\ |\ undefined>}

\end{DoxyCode}


加载任务，委托给真实存储。

参数：
\begin{DoxyItemize}
\item {\ttfamily task\+Id}\+: 任务 ID
\end{DoxyItemize}

返回：
\begin{DoxyItemize}
\item Promise\texorpdfstring{$<$}{<}SDKTask \texorpdfstring{$\vert$}{|} undefined\texorpdfstring{$>$}{>}\+: SDK 任务对象或 undefined
\end{DoxyItemize}\hypertarget{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md138}{}\doxysection{\texorpdfstring{类型定义}{类型定义}}\label{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md138}
\hypertarget{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md139}{}\doxysubsection{\texorpdfstring{Object\+Type 类型}{Object\+Type 类型}}\label{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md139}

\begin{DoxyCode}{0}
\DoxyCodeLine{type\ ObjectType\ =\ 'metadata'\ |\ 'workspace';}

\end{DoxyCode}


对象类型联合类型。\hypertarget{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md140}{}\doxysection{\texorpdfstring{辅助函数}{辅助函数}}\label{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md140}
\hypertarget{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md141}{}\doxysubsection{\texorpdfstring{get\+Tmp\+Archive\+Filename 函数}{get\+Tmp\+Archive\+Filename 函数}}\label{md_packages_2a2a-server_2src_2persistence_2gcs_8ts_autotoc_md141}

\begin{DoxyCode}{0}
\DoxyCodeLine{const\ getTmpArchiveFilename\ =\ (taskId:\ string):\ string}

\end{DoxyCode}


获取临时归档文件名。

参数：
\begin{DoxyItemize}
\item {\ttfamily task\+Id}\+: 任务 ID
\end{DoxyItemize}

返回：
\begin{DoxyItemize}
\item string\+: 临时归档文件名 
\end{DoxyItemize}