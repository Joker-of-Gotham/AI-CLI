\chapter{Turn 类和相关类型 }
\hypertarget{md_packages_2core_2src_2core_2turn}{}\label{md_packages_2core_2src_2core_2turn}\index{Turn 类和相关类型@{Turn 类和相关类型}}
\label{md_packages_2core_2src_2core_2turn_autotoc_md625}%
\Hypertarget{md_packages_2core_2src_2core_2turn_autotoc_md625}%


Turn 类管理服务器上下文中的代理循环轮次。\hypertarget{md_packages_2core_2src_2core_2turn_autotoc_md626}{}\doxysection{\texorpdfstring{Turn 类}{Turn 类}}\label{md_packages_2core_2src_2core_2turn_autotoc_md626}
\hypertarget{md_packages_2core_2src_2core_2turn_autotoc_md627}{}\doxysubsection{\texorpdfstring{主要功能}{主要功能}}\label{md_packages_2core_2src_2core_2turn_autotoc_md627}

\begin{DoxyEnumerate}
\item \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}运行管理\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}：执行聊天轮次并生成响应事件
\item \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}工具调用处理\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}：处理函数调用请求和响应
\item \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}错误处理\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}：捕获和处理聊天过程中的错误
\item \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}调试支持\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}：记录响应用于调试
\end{DoxyEnumerate}\hypertarget{md_packages_2core_2src_2core_2turn_autotoc_md628}{}\doxysubsection{\texorpdfstring{核心方法}{核心方法}}\label{md_packages_2core_2src_2core_2turn_autotoc_md628}

\begin{DoxyItemize}
\item {\ttfamily run()} -\/ 执行聊天轮次，生成流式事件
\item {\ttfamily get\+Debug\+Responses()} -\/ 获取调试用的响应记录
\end{DoxyItemize}\hypertarget{md_packages_2core_2src_2core_2turn_autotoc_md629}{}\doxysubsection{\texorpdfstring{属性}{属性}}\label{md_packages_2core_2src_2core_2turn_autotoc_md629}

\begin{DoxyItemize}
\item {\ttfamily pending\+Tool\+Calls} -\/ 待处理的工具调用列表
\item {\ttfamily finish\+Reason} -\/ 对话结束原因
\end{DoxyItemize}\hypertarget{md_packages_2core_2src_2core_2turn_autotoc_md630}{}\doxysection{\texorpdfstring{事件类型}{事件类型}}\label{md_packages_2core_2src_2core_2turn_autotoc_md630}
\hypertarget{md_packages_2core_2src_2core_2turn_autotoc_md631}{}\doxysubsection{\texorpdfstring{Gemini\+Event\+Type 枚举}{Gemini\+Event\+Type 枚举}}\label{md_packages_2core_2src_2core_2turn_autotoc_md631}
定义了各种 Gemini 事件类型：
\begin{DoxyItemize}
\item {\ttfamily Content} -\/ 内容事件
\item {\ttfamily Tool\+Call\+Request} -\/ 工具调用请求事件
\item {\ttfamily Tool\+Call\+Response} -\/ 工具调用响应事件
\item {\ttfamily Tool\+Call\+Confirmation} -\/ 工具调用确认事件
\item {\ttfamily User\+Cancelled} -\/ 用户取消事件
\item {\ttfamily Error} -\/ 错误事件
\item {\ttfamily Chat\+Compressed} -\/ 聊天压缩事件
\item {\ttfamily Thought} -\/ 思考事件
\item {\ttfamily Max\+Session\+Turns} -\/ 最大会话轮次事件
\item {\ttfamily Finished} -\/ 完成事件
\item {\ttfamily Loop\+Detected} -\/ 循环检测事件
\item {\ttfamily Citation} -\/ 引用事件
\item {\ttfamily Retry} -\/ 重试事件
\end{DoxyItemize}\hypertarget{md_packages_2core_2src_2core_2turn_autotoc_md632}{}\doxysection{\texorpdfstring{数据结构}{数据结构}}\label{md_packages_2core_2src_2core_2turn_autotoc_md632}
\hypertarget{md_packages_2core_2src_2core_2turn_autotoc_md633}{}\doxysubsection{\texorpdfstring{Server\+Gemini\+Stream\+Event}{Server\+Gemini\+Stream\+Event}}\label{md_packages_2core_2src_2core_2turn_autotoc_md633}
联合类型，包含所有可能的服务器 Gemini 流事件。\hypertarget{md_packages_2core_2src_2core_2turn_autotoc_md634}{}\doxysubsection{\texorpdfstring{Compression\+Status 枚举}{Compression\+Status 枚举}}\label{md_packages_2core_2src_2core_2turn_autotoc_md634}
定义聊天压缩状态：
\begin{DoxyItemize}
\item {\ttfamily COMPRESSED} -\/ 压缩成功
\item {\ttfamily COMPRESSION\+\_\+\+FAILED\+\_\+\+INFLATED\+\_\+\+TOKEN\+\_\+\+COUNT} -\/ 压缩失败（token 数量增加）
\item {\ttfamily COMPRESSION\+\_\+\+FAILED\+\_\+\+TOKEN\+\_\+\+COUNT\+\_\+\+ERROR} -\/ 压缩失败（token 计数错误）
\item {\ttfamily NOOP} -\/ 无需操作
\end{DoxyItemize}\hypertarget{md_packages_2core_2src_2core_2turn_autotoc_md635}{}\doxysubsection{\texorpdfstring{Chat\+Compression\+Info 接口}{Chat\+Compression\+Info 接口}}\label{md_packages_2core_2src_2core_2turn_autotoc_md635}
包含聊天压缩信息：
\begin{DoxyItemize}
\item {\ttfamily original\+Token\+Count} -\/ 原始 token 数量
\item {\ttfamily new\+Token\+Count} -\/ 新 token 数量
\item {\ttfamily compression\+Status} -\/ 压缩状态
\end{DoxyItemize}\hypertarget{md_packages_2core_2src_2core_2turn_autotoc_md636}{}\doxysection{\texorpdfstring{辅助函数}{辅助函数}}\label{md_packages_2core_2src_2core_2turn_autotoc_md636}
\hypertarget{md_packages_2core_2src_2core_2turn_autotoc_md637}{}\doxysubsection{\texorpdfstring{get\+Citations()}{get\+Citations()}}\label{md_packages_2core_2src_2core_2turn_autotoc_md637}
从生成内容响应中提取引用信息。 