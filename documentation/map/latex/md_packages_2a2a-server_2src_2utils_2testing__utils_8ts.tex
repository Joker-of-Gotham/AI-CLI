\chapter{testing\+\_\+utils.\+ts }
\hypertarget{md_packages_2a2a-server_2src_2utils_2testing__utils_8ts}{}\label{md_packages_2a2a-server_2src_2utils_2testing__utils_8ts}\index{testing\_utils.ts@{testing\_utils.ts}}
\label{md_packages_2a2a-server_2src_2utils_2testing__utils_8ts_autotoc_md153}%
\Hypertarget{md_packages_2a2a-server_2src_2utils_2testing__utils_8ts_autotoc_md153}%
\hypertarget{md_packages_2a2a-server_2src_2utils_2testing__utils_8ts_autotoc_md154}{}\doxysection{\texorpdfstring{概述}{概述}}\label{md_packages_2a2a-server_2src_2utils_2testing__utils_8ts_autotoc_md154}
{\ttfamily \doxylink{testing__utils_8ts}{testing\+\_\+utils.\+ts}} 是 a2a-\/server 包中的测试工具文件。该文件提供了一系列用于简化测试编写的辅助函数和模拟配置，主要用于创建模拟对象和验证测试结果。\hypertarget{md_packages_2a2a-server_2src_2utils_2testing__utils_8ts_autotoc_md155}{}\doxysection{\texorpdfstring{导出的函数}{导出的函数}}\label{md_packages_2a2a-server_2src_2utils_2testing__utils_8ts_autotoc_md155}
\hypertarget{md_packages_2a2a-server_2src_2utils_2testing__utils_8ts_autotoc_md156}{}\doxysubsection{\texorpdfstring{create\+Mock\+Config}{create\+Mock\+Config}}\label{md_packages_2a2a-server_2src_2utils_2testing__utils_8ts_autotoc_md156}
创建一个模拟的配置对象，用于测试需要配置参数的组件：
\begin{DoxyItemize}
\item 接受可选的覆盖配置对象作为参数
\item 返回包含各种模拟方法的配置对象
\item 默认模拟工具注册表、审批模式、\+IDE 模式等配置
\item 提供默认的存储、目标目录和模型配置
\end{DoxyItemize}\hypertarget{md_packages_2a2a-server_2src_2utils_2testing__utils_8ts_autotoc_md157}{}\doxysubsection{\texorpdfstring{create\+Stream\+Message\+Request}{create\+Stream\+Message\+Request}}\label{md_packages_2a2a-server_2src_2utils_2testing__utils_8ts_autotoc_md157}
创建一个用于测试的流消息请求对象：
\begin{DoxyItemize}
\item 接受文本内容、消息 ID 和可选的任务 ID 作为参数
\item 返回符合 JSON-\/\+RPC 2.\+0 标准的消息请求对象
\item 包含消息内容、元数据和 coder\+Agent 配置
\end{DoxyItemize}\hypertarget{md_packages_2a2a-server_2src_2utils_2testing__utils_8ts_autotoc_md158}{}\doxysubsection{\texorpdfstring{assert\+Unique\+Final\+Event\+Is\+Last}{assert\+Unique\+Final\+Event\+Is\+Last}}\label{md_packages_2a2a-server_2src_2utils_2testing__utils_8ts_autotoc_md158}
验证事件数组中的最终事件：
\begin{DoxyItemize}
\item 检查最后一个事件是否为最终的输入请求状态事件
\item 验证事件数组中只有一个最终事件且位于最后位置
\item 确认最终事件的元数据和状态正确
\end{DoxyItemize}\hypertarget{md_packages_2a2a-server_2src_2utils_2testing__utils_8ts_autotoc_md159}{}\doxysubsection{\texorpdfstring{assert\+Task\+Creation\+And\+Working\+Status}{assert\+Task\+Creation\+And\+Working\+Status}}\label{md_packages_2a2a-server_2src_2utils_2testing__utils_8ts_autotoc_md159}
验证任务创建和工作状态事件：
\begin{DoxyItemize}
\item 检查第一个事件是否为任务创建事件
\item 验证第二个事件是否为工作状态更新事件
\item 确认事件的类型和状态值正确
\end{DoxyItemize}\hypertarget{md_packages_2a2a-server_2src_2utils_2testing__utils_8ts_autotoc_md160}{}\doxysection{\texorpdfstring{使用的技术}{使用的技术}}\label{md_packages_2a2a-server_2src_2utils_2testing__utils_8ts_autotoc_md160}

\begin{DoxyItemize}
\item {\bfseries{Vitest}}\+: 使用 {\ttfamily vi.\+fn()} 创建模拟函数
\item {\bfseries{Type\+Script}}\+: 使用类型注解确保类型安全
\item {\bfseries{Partial Types}}\+: 使用 Partial$<$\+Config$>$ 允许部分配置覆盖
\end{DoxyItemize}\hypertarget{md_packages_2a2a-server_2src_2utils_2testing__utils_8ts_autotoc_md161}{}\doxysection{\texorpdfstring{依赖模块}{依赖模块}}\label{md_packages_2a2a-server_2src_2utils_2testing__utils_8ts_autotoc_md161}

\begin{DoxyItemize}
\item {\ttfamily @a2a-\/js/sdk}\+: 提供任务和事件相关类型
\item {\ttfamily @google/gemini-\/cli-\/core}\+: 提供配置、存储和客户端相关类型
\item {\ttfamily vitest}\+: 提供测试框架功能
\end{DoxyItemize}\hypertarget{md_packages_2a2a-server_2src_2utils_2testing__utils_8ts_autotoc_md162}{}\doxysection{\texorpdfstring{设计考虑}{设计考虑}}\label{md_packages_2a2a-server_2src_2utils_2testing__utils_8ts_autotoc_md162}
该工具文件的设计旨在：
\begin{DoxyEnumerate}
\item 减少测试代码中的重复配置
\item 提供一致的测试数据创建方式
\item 简化复杂对象的模拟过程
\item 提供通用的断言函数验证测试结果 
\end{DoxyEnumerate}