\chapter{sandbox\+Config.\+ts }
\hypertarget{md_packages_2cli_2src_2config_2sandbox_config_8ts}{}\label{md_packages_2cli_2src_2config_2sandbox_config_8ts}\index{sandboxConfig.ts@{sandboxConfig.ts}}
\label{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md329}%
\Hypertarget{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md329}%
\hypertarget{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md330}{}\doxysection{\texorpdfstring{概述}{概述}}\label{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md330}
{\ttfamily \doxylink{sandbox_config_8ts}{sandbox\+Config.\+ts}} 是 cli 包中处理沙箱配置的模块。该文件负责加载和验证沙箱配置，支持多种沙箱技术如 Docker、\+Podman 和 sandbox-\/exec。\hypertarget{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md331}{}\doxysection{\texorpdfstring{导出的函数}{导出的函数}}\label{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md331}
\hypertarget{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md332}{}\doxysubsection{\texorpdfstring{load\+Sandbox\+Config}{load\+Sandbox\+Config}}\label{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md332}
异步加载沙箱配置：


\begin{DoxyEnumerate}
\item {\bfseries{参数}}\+:
\begin{DoxyItemize}
\item {\ttfamily settings}\+: Settings 类型，包含用户设置
\item {\ttfamily argv}\+: Sandbox\+Cli\+Args 类型，包含命令行参数
\end{DoxyItemize}
\item {\bfseries{功能}}\+:
\begin{DoxyItemize}
\item 获取沙箱选项（来自命令行参数或设置）
\item 调用 {\ttfamily get\+Sandbox\+Command} 确定沙箱命令
\item 获取沙箱镜像（来自命令行参数、环境变量或 package.\+json）
\item 返回包含命令和镜像的沙箱配置对象，如果未启用沙箱则返回 undefined
\end{DoxyItemize}
\item {\bfseries{返回值}}\+:
\begin{DoxyItemize}
\item 沙箱配置对象或 undefined
\end{DoxyItemize}
\end{DoxyEnumerate}\hypertarget{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md333}{}\doxysubsection{\texorpdfstring{get\+Sandbox\+Command (内部函数)}{get\+Sandbox\+Command (内部函数)}}\label{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md333}
确定要使用的沙箱命令：


\begin{DoxyEnumerate}
\item {\bfseries{参数}}\+:
\begin{DoxyItemize}
\item {\ttfamily sandbox}\+: boolean \texorpdfstring{$\vert$}{|} string 类型，沙箱选项
\end{DoxyItemize}
\item {\bfseries{功能}}\+:
\begin{DoxyItemize}
\item 检查是否已在沙箱环境中运行（通过 {\ttfamily SANDBOX} 环境变量）
\item 处理环境变量 {\ttfamily GEMINI\+\_\+\+SANDBOX} 和命令行参数
\item 验证指定的沙箱命令是否有效且存在
\item 根据平台和可用命令自动选择沙箱技术
\item 支持 sandbox-\/exec（mac\+OS）、\+Docker 和 Podman
\end{DoxyItemize}
\item {\bfseries{返回值}}\+:
\begin{DoxyItemize}
\item 沙箱命令字符串或空字符串（表示不使用沙箱）
\end{DoxyItemize}
\end{DoxyEnumerate}\hypertarget{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md334}{}\doxysection{\texorpdfstring{类型定义}{类型定义}}\label{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md334}
\hypertarget{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md335}{}\doxysubsection{\texorpdfstring{Sandbox\+Cli\+Args}{Sandbox\+Cli\+Args}}\label{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md335}
简化版的命令行参数接口，避免循环依赖：
\begin{DoxyItemize}
\item {\ttfamily sandbox}\+: boolean \texorpdfstring{$\vert$}{|} string（可选）
\item {\ttfamily sandbox\+Image}\+: string（可选）
\end{DoxyItemize}\hypertarget{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md336}{}\doxysection{\texorpdfstring{常量}{常量}}\label{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md336}
\hypertarget{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md337}{}\doxysubsection{\texorpdfstring{VALID\+\_\+\+SANDBOX\+\_\+\+COMMANDS}{VALID\+\_\+\+SANDBOX\+\_\+\+COMMANDS}}\label{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md337}
有效的沙箱命令列表：
\begin{DoxyItemize}
\item {\ttfamily docker}
\item {\ttfamily podman}
\item {\ttfamily sandbox-\/exec}
\end{DoxyItemize}\hypertarget{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md338}{}\doxysection{\texorpdfstring{依赖模块}{依赖模块}}\label{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md338}

\begin{DoxyItemize}
\item {\ttfamily @google/gemini-\/cli-\/core}\+: 提供 {\ttfamily Fatal\+Sandbox\+Error} 类型
\item {\ttfamily command-\/exists}\+: 检查命令是否存在
\item {\ttfamily node\+:os}\+: Node.\+js 操作系统模块
\item {\ttfamily ../utils/package.js}\+: 获取 package.\+json 信息
\item {\ttfamily ./settings.js}\+: Settings 类型
\end{DoxyItemize}\hypertarget{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md339}{}\doxysection{\texorpdfstring{使用场景}{使用场景}}\label{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md339}
该模块主要用于：
\begin{DoxyEnumerate}
\item 根据用户配置和环境确定沙箱设置
\item 验证沙箱命令的有效性
\item 提供安全的代码执行环境
\end{DoxyEnumerate}\hypertarget{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md340}{}\doxysection{\texorpdfstring{设计考虑}{设计考虑}}\label{md_packages_2cli_2src_2config_2sandbox_config_8ts_autotoc_md340}
该模块的设计考虑了：
\begin{DoxyEnumerate}
\item 多种沙箱技术的支持
\item 环境变量优先级高于配置文件
\item 自动检测可用的沙箱命令
\item 详细的错误信息帮助用户配置沙箱
\item 避免循环依赖的设计 
\end{DoxyEnumerate}