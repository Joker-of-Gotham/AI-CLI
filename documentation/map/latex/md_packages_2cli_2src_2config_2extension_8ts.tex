\chapter{extension.\+ts }
\hypertarget{md_packages_2cli_2src_2config_2extension_8ts}{}\label{md_packages_2cli_2src_2config_2extension_8ts}\index{extension.ts@{extension.ts}}
\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md290}%
\Hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md290}%


扩展管理模块，负责处理 Gemini CLI 扩展的安装、加载和管理。\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md291}{}\doxysection{\texorpdfstring{功能概述}{功能概述}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md291}

\begin{DoxyEnumerate}
\item 扩展加载和解析
\item 扩展安装和卸载
\item 扩展更新和迁移
\item 扩展启用和禁用
\end{DoxyEnumerate}\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md292}{}\doxysection{\texorpdfstring{主要接口}{主要接口}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md292}
\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md293}{}\doxysubsection{\texorpdfstring{Extension}{Extension}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md293}
表示一个已加载的扩展：
\begin{DoxyItemize}
\item path\+: 扩展路径
\item config\+: 扩展配置
\item context\+Files\+: 上下文文件列表
\item install\+Metadata\+: 安装元数据（可选）
\end{DoxyItemize}\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md294}{}\doxysubsection{\texorpdfstring{Extension\+Config}{Extension\+Config}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md294}
扩展配置接口：
\begin{DoxyItemize}
\item name\+: 扩展名称
\item version\+: 扩展版本
\item mcp\+Servers\+: MCP 服务器配置（可选）
\item context\+File\+Name\+: 上下文文件名（可选）
\item exclude\+Tools\+: 排除工具列表（可选）
\end{DoxyItemize}\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md295}{}\doxysubsection{\texorpdfstring{Extension\+Install\+Metadata}{Extension\+Install\+Metadata}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md295}
扩展安装元数据：
\begin{DoxyItemize}
\item source\+: 安装源
\item type\+: 安装类型（\textquotesingle{}git\textquotesingle{} \texorpdfstring{$\vert$}{|} \textquotesingle{}local\textquotesingle{} \texorpdfstring{$\vert$}{|} \textquotesingle{}link\textquotesingle{}）
\end{DoxyItemize}\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md296}{}\doxysection{\texorpdfstring{主要类}{主要类}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md296}
\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md297}{}\doxysubsection{\texorpdfstring{Extension\+Storage}{Extension\+Storage}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md297}
扩展存储管理类：
\begin{DoxyItemize}
\item get\+Extension\+Dir()\+: 获取扩展目录
\item get\+Config\+Path()\+: 获取配置文件路径
\item static get\+User\+Extensions\+Dir()\+: 获取用户扩展目录
\item static create\+Tmp\+Dir()\+: 创建临时目录
\end{DoxyItemize}\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md298}{}\doxysection{\texorpdfstring{主要函数}{主要函数}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md298}
\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md299}{}\doxysubsection{\texorpdfstring{load\+Extensions(workspace\+Dir\+: string = process.\+cwd())\+: Extension\mbox{[}\mbox{]}}{load\+Extensions(workspace\+Dir\+: string = process.\+cwd())\+: Extension\mbox{[}\mbox{]}}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md299}
加载所有扩展：
\begin{DoxyEnumerate}
\item 加载用户扩展
\item 根据工作区信任状态加载工作区扩展
\item 合并扩展并去重
\item 过滤禁用的扩展
\end{DoxyEnumerate}\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md300}{}\doxysubsection{\texorpdfstring{load\+User\+Extensions()\+: Extension\mbox{[}\mbox{]}}{load\+User\+Extensions()\+: Extension\mbox{[}\mbox{]}}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md300}
加载用户扩展：
\begin{DoxyEnumerate}
\item 从用户目录加载扩展
\item 去重处理
\item 返回唯一扩展列表
\end{DoxyEnumerate}\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md301}{}\doxysubsection{\texorpdfstring{load\+Extensions\+From\+Dir(dir\+: string)\+: Extension\mbox{[}\mbox{]}}{load\+Extensions\+From\+Dir(dir\+: string)\+: Extension\mbox{[}\mbox{]}}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md301}
从指定目录加载扩展：
\begin{DoxyEnumerate}
\item 获取扩展目录
\item 遍历子目录
\item 加载每个扩展
\item 返回扩展列表
\end{DoxyEnumerate}\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md302}{}\doxysubsection{\texorpdfstring{load\+Extension(extension\+Dir\+: string)\+: Extension \texorpdfstring{$\vert$}{|} null}{load\+Extension(extension\+Dir\+: string)\+: Extension \texorpdfstring{$\vert$}{|} null}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md302}
加载单个扩展：
\begin{DoxyEnumerate}
\item 验证目录有效性
\item 加载安装元数据
\item 解析配置文件
\item 处理上下文文件
\item 返回扩展对象
\end{DoxyEnumerate}\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md303}{}\doxysubsection{\texorpdfstring{install\+Extension(install\+Metadata\+: Extension\+Install\+Metadata, cwd\+: string = process.\+cwd())\+: Promise$<$string$>$}{install\+Extension(install\+Metadata\+: Extension\+Install\+Metadata, cwd\+: string = process.\+cwd())\+: Promise$<$string$>$}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md303}
安装扩展：
\begin{DoxyEnumerate}
\item 验证工作区信任状态
\item 创建用户扩展目录
\item 根据安装类型处理源
\item 克隆 Git 仓库或复制本地文件
\item 验证扩展配置
\item 复制文件到目标位置
\item 保存安装元数据
\item 返回扩展名称
\end{DoxyEnumerate}\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md304}{}\doxysubsection{\texorpdfstring{uninstall\+Extension(extension\+Name\+: string, cwd\+: string = process.\+cwd())\+: Promise$<$void$>$}{uninstall\+Extension(extension\+Name\+: string, cwd\+: string = process.\+cwd())\+: Promise$<$void$>$}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md304}
卸载扩展：
\begin{DoxyEnumerate}
\item 验证扩展是否存在
\item 从禁用列表中移除
\item 删除扩展目录
\end{DoxyEnumerate}\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md305}{}\doxysubsection{\texorpdfstring{update\+Extension(extension\+: Extension, cwd\+: string = process.\+cwd())\+: Promise$<$\+Extension\+Update\+Info$>$}{update\+Extension(extension\+: Extension, cwd\+: string = process.\+cwd())\+: Promise$<$\+Extension\+Update\+Info$>$}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md305}
更新扩展：
\begin{DoxyEnumerate}
\item 验证扩展是否可更新
\item 创建备份
\item 卸载当前版本
\item 重新安装新版本
\item 处理更新失败回滚
\end{DoxyEnumerate}\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md306}{}\doxysubsection{\texorpdfstring{disable\+Extension(name\+: string, scope\+: Setting\+Scope, cwd\+: string = process.\+cwd())}{disable\+Extension(name\+: string, scope\+: Setting\+Scope, cwd\+: string = process.\+cwd())}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md306}
禁用扩展：
\begin{DoxyEnumerate}
\item 将扩展添加到禁用列表
\item 保存设置
\end{DoxyEnumerate}\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md307}{}\doxysubsection{\texorpdfstring{enable\+Extension(name\+: string, scopes\+: Setting\+Scope\mbox{[}$\,$\mbox{]})}{enable\+Extension(name\+: string, scopes\+: Setting\+Scope\mbox{[}$\,$\mbox{]})}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md307}
启用扩展：
\begin{DoxyEnumerate}
\item 从禁用列表中移除扩展
\item 保存设置
\end{DoxyEnumerate}\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md308}{}\doxysection{\texorpdfstring{辅助函数}{辅助函数}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md308}
\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md309}{}\doxysubsection{\texorpdfstring{annotate\+Active\+Extensions(extensions, enabled\+Extension\+Names, workspace\+Dir)\+: Gemini\+CLIExtension\mbox{[}\mbox{]}}{annotate\+Active\+Extensions(extensions, enabled\+Extension\+Names, workspace\+Dir)\+: Gemini\+CLIExtension\mbox{[}\mbox{]}}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md309}
标注活动扩展：
\begin{DoxyItemize}
\item 根据启用列表标记扩展状态
\item 处理 "{}none"{} 特殊值
\item 返回带状态的扩展列表
\end{DoxyItemize}\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md310}{}\doxysubsection{\texorpdfstring{to\+Output\+String(extension\+: Extension)\+: string}{to\+Output\+String(extension\+: Extension)\+: string}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md310}
将扩展信息格式化为字符串：
\begin{DoxyItemize}
\item 包含名称、版本、路径
\item 显示安装源信息
\item 列出上下文文件
\item 显示 MCP 服务器和排除工具
\end{DoxyItemize}\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md311}{}\doxysubsection{\texorpdfstring{perform\+Workspace\+Extension\+Migration(extensions\+: Extension\mbox{[}$\,$\mbox{]})\+: Promise$<$string\mbox{[}$\,$\mbox{]}$>$}{perform\+Workspace\+Extension\+Migration(extensions\+: Extension\mbox{[}$\,$\mbox{]})\+: Promise$<$string\mbox{[}$\,$\mbox{]}$>$}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md311}
执行工作区扩展迁移：
\begin{DoxyItemize}
\item 将工作区扩展迁移到用户扩展
\item 返回迁移失败的扩展名称列表
\end{DoxyItemize}\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md312}{}\doxysection{\texorpdfstring{常量}{常量}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md312}
\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md313}{}\doxysubsection{\texorpdfstring{EXTENSIONS\+\_\+\+DIRECTORY\+\_\+\+NAME}{EXTENSIONS\+\_\+\+DIRECTORY\+\_\+\+NAME}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md313}
扩展目录名称：$<$tt$>$.\+gemini/extensions\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md314}{}\doxysubsection{\texorpdfstring{EXTENSIONS\+\_\+\+CONFIG\+\_\+\+FILENAME}{EXTENSIONS\+\_\+\+CONFIG\+\_\+\+FILENAME}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md314}
扩展配置文件名：{\ttfamily gemini-\/extension.\+json}\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md315}{}\doxysubsection{\texorpdfstring{INSTALL\+\_\+\+METADATA\+\_\+\+FILENAME}{INSTALL\+\_\+\+METADATA\+\_\+\+FILENAME}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md315}
安装元数据文件名：$<$tt$>$.\+gemini-\/extension-\/install.\+json\hypertarget{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md316}{}\doxysection{\texorpdfstring{使用场景}{使用场景}}\label{md_packages_2cli_2src_2config_2extension_8ts_autotoc_md316}

\begin{DoxyItemize}
\item CLI 启动时加载扩展
\item 扩展管理命令执行
\item 工作区扩展迁移
\item 扩展配置解析 
\end{DoxyItemize}