\chapter{聊天记录服务 (Chat\+Recording\+Service) }
\hypertarget{md_packages_2core_2src_2services_2chat_recording_service}{}\label{md_packages_2core_2src_2services_2chat_recording_service}\index{聊天记录服务 (ChatRecordingService)@{聊天记录服务 (ChatRecordingService)}}
\label{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md712}%
\Hypertarget{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md712}%


聊天记录服务负责自动记录聊天会话到磁盘，提供完整的会话历史记录功能。\hypertarget{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md713}{}\doxysection{\texorpdfstring{主要功能}{主要功能}}\label{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md713}

\begin{DoxyEnumerate}
\item \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}会话记录\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}：记录用户和助手的所有消息
\item \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}工具调用跟踪\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}：记录工具调用及其执行结果
\item \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}\+Token 使用统计\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}：记录消息的 Token 使用情况
\item \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}助手思考过程\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}：记录助手的推理和思考过程
\item \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}会话恢复\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}：支持从现有会话恢复
\end{DoxyEnumerate}\hypertarget{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md714}{}\doxysection{\texorpdfstring{核心数据结构}{核心数据结构}}\label{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md714}
\hypertarget{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md715}{}\doxysubsection{\texorpdfstring{Conversation\+Record}{Conversation\+Record}}\label{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md715}
完整的会话记录结构：
\begin{DoxyItemize}
\item {\ttfamily session\+Id} -\/ 会话\+ID
\item {\ttfamily project\+Hash} -\/ 项目哈希
\item {\ttfamily start\+Time} -\/ 会话开始时间
\item {\ttfamily last\+Updated} -\/ 最后更新时间
\item {\ttfamily messages} -\/ 消息记录列表
\end{DoxyItemize}\hypertarget{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md716}{}\doxysubsection{\texorpdfstring{Message\+Record}{Message\+Record}}\label{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md716}
单条消息记录：
\begin{DoxyItemize}
\item {\ttfamily id} -\/ 消息\+ID
\item {\ttfamily timestamp} -\/ 时间戳
\item {\ttfamily content} -\/ 消息内容
\item {\ttfamily type} -\/ 消息类型（user/gemini）
\end{DoxyItemize}\hypertarget{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md717}{}\doxysubsection{\texorpdfstring{Tool\+Call\+Record}{Tool\+Call\+Record}}\label{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md717}
工具调用记录：
\begin{DoxyItemize}
\item {\ttfamily id} -\/ 调用\+ID
\item {\ttfamily name} -\/ 工具名称
\item {\ttfamily args} -\/ 调用参数
\item {\ttfamily result} -\/ 执行结果
\item {\ttfamily status} -\/ 执行状态
\item {\ttfamily timestamp} -\/ 时间戳
\end{DoxyItemize}\hypertarget{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md718}{}\doxysection{\texorpdfstring{核心方法}{核心方法}}\label{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md718}
\hypertarget{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md719}{}\doxysubsection{\texorpdfstring{初始化}{初始化}}\label{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md719}

\begin{DoxyItemize}
\item {\ttfamily initialize()} -\/ 初始化聊天记录服务
\item 支持创建新会话或从现有会话恢复
\end{DoxyItemize}\hypertarget{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md720}{}\doxysubsection{\texorpdfstring{记录操作}{记录操作}}\label{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md720}

\begin{DoxyItemize}
\item {\ttfamily record\+Message()} -\/ 记录消息
\item {\ttfamily record\+Thought()} -\/ 记录助手思考
\item {\ttfamily record\+Message\+Tokens()} -\/ 记录消息 Token 使用
\item {\ttfamily record\+Tool\+Calls()} -\/ 记录工具调用
\end{DoxyItemize}\hypertarget{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md721}{}\doxysubsection{\texorpdfstring{会话管理}{会话管理}}\label{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md721}

\begin{DoxyItemize}
\item {\ttfamily delete\+Session()} -\/ 删除会话记录
\end{DoxyItemize}\hypertarget{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md722}{}\doxysection{\texorpdfstring{特殊功能}{特殊功能}}\label{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md722}
\hypertarget{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md723}{}\doxysubsection{\texorpdfstring{实时更新}{实时更新}}\label{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md723}

\begin{DoxyItemize}
\item 自动将记录写入磁盘
\item 避免重复写入相同内容
\item 时间戳自动更新
\end{DoxyItemize}\hypertarget{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md724}{}\doxysubsection{\texorpdfstring{数据丰富}{数据丰富}}\label{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md724}

\begin{DoxyItemize}
\item 自动添加工具显示名称和描述
\item 丰富工具调用的元数据
\item 格式化输出用于显示
\end{DoxyItemize}\hypertarget{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md725}{}\doxysubsection{\texorpdfstring{会话恢复}{会话恢复}}\label{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md725}

\begin{DoxyItemize}
\item 支持从现有会话文件恢复
\item 更新会话\+ID以匹配当前会话
\item 保持历史记录完整性
\end{DoxyItemize}\hypertarget{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md726}{}\doxysubsection{\texorpdfstring{文件管理}{文件管理}}\label{md_packages_2core_2src_2services_2chat_recording_service_autotoc_md726}

\begin{DoxyItemize}
\item 自动创建聊天记录目录
\item 使用时间戳和会话\+ID命名文件
\item 安全的文件读写操作 
\end{DoxyItemize}